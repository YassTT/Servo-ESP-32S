#include <Servo.h>

const int nbServos = 5;
const int pinsServos[nbServos] = {3, 5, 6, 9, 10};
Servo servos[nbServos];

const int pinButton = 2;
bool previousButtonState = HIGH;
bool cycleActive = false;
unsigned long lastActionTime = 0;
unsigned long moveDuration = 1000; 
unsigned long pauseDuration = 2000; 
unsigned long cycleStartTime = 0;

void setup() {
  pinMode(pinButton, INPUT_PULLUP);


  for (int i = 0; i < nbServos; i++) {
    servos[i].attach(pinsServos[i]);
    servos[i].write(0);
  }
}

void loop() {
  unsigned long currentMillis = millis();
  bool buttonState = digitalRead(pinButton);


  if (buttonState == LOW && previousButtonState == HIGH) {
    if (cycleActive) {

      cycleActive = false;
      resetServos();
    } else {

      cycleActive = true;
      cycleStartTime = currentMillis;
      moveServosTo180();
    }
  }


  if (cycleActive) {

    if (currentMillis - cycleStartTime >= moveDuration && currentMillis - cycleStartTime < moveDuration + 100) {
      moveServosTo0();
    }


    if (currentMillis - cycleStartTime >= moveDuration + pauseDuration && currentMillis - cycleStartTime < moveDuration + pauseDuration + 100) {
      moveServosTo180();
    }


    if (currentMillis - cycleStartTime >= moveDuration + pauseDuration * 2) {
      cycleStartTime = currentMillis;
    }
  }

  previousButtonState = buttonState;
}


void moveServosTo180() {
  for (int i = 0; i < nbServos; i++) {
    servos[i].write(180);
    delay(100);
  }
}


void moveServosTo0() {
  for (int i = 0; i < nbServos; i++) {
    servos[i].write(0);
  }
}


void resetServos() {
  for (int i = 0; i < nbServos; i++) {
    servos[i].write(0);
  }
}
